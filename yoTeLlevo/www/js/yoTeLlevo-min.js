angular.module("yoTeLlevo",["ionic","angular-toast"]).run(["$ionicPlatform",function(e){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider","$httpProvider",function(e,o,n,t){e.state("login",{url:"/login",template:"<login-component></login-component>"}).state("register",{url:"/register",template:"<register-component></register-component>"}).state("dashboard",{url:"/dashboard",template:"<dashboard-component></dashboard-component>"}),o.otherwise("/login"),n.views.transition("ios"),n.tabs.position("top"),delete t.defaults.headers.common["X-Requested-With"]}]),function(){function e(e,o,n,t,i,a,r,l,s,c){function u(o){e.cleanMapVariables(),a.fromTemplateUrl(o,{scope:e,animation:"slide-in-up"}).then(function(o){e.modal=o,e.modal.show()})}function d(){u("templates/modals/addNewRoute.html")}function g(){u("templates/modals/addNewPoint.html")}var p=c(function(){l.checkNotifications().then(function(e){if(e)for(var o=0;o<e.lenght;o++)l.sendNotification(e[o])})},3e3);i.sessionStarted=!0,e.points=[],e.tabs={tabIndex:!1},e.cleanMapVariables=function(){e.encodedRoute="",e.searchs={destination:"",origin:""},e.markers=null,e.destinationResults=null,e.originResults=null,e.destinationPlace=null,e.originPlace=null},i.sessionStarted||n.go("login"),e.logout=function(){c.cancel(p),e.show(),setTimeout(function(){e.hide(),n.go("login")},2e3)},e.show=function(){o.show({template:"Loading...",duration:3e3}).then(function(){console.log("The loading indicator is now displayed")})},e.hide=function(){o.hide().then(function(){console.log("The loading indicator is now hidden")})},e.tabChange=function(){},e.fabOnClick=function(){e.tabs.tabIndex?g():d()},e.closeModal=function(){e.modal.hide(),e.modal&&e.modal.remove()},e.$on("$destroy",function(){e.modal&&e.modal.remove()}),e.$watch("searchs",function(o,n){o&&o.origin&&o.origin!==n.origin&&e.takeOrigin?(e.originLoading=!0,e.searchs.originValue=o.origin):e.takeOrigin=!0,o&&o.destination&&o.destination!=n.destination&&e.takeDest?(e.destinationLoading=!0,e.searchs.destinationValue=o.destination):e.takeDest=!0},!0),e.$watch("encodedRoute",function(e,o){console.log("jpjpojpojpojpojpojpojojojpjpp",e,o)},!0),e.$watch("tabs",function(o,n){o.tabIndex?l.getPoints().then(function(o){console.log(o),e.points=o.result}):l.getRoutes().then(function(o){console.log(o),e.routes=o.result})},!0),e.createOrigin=function(o){e.destinationResults=null,e.originResults=o,e.originLoading=!1,e.$apply()},e.createDestination=function(o){e.originResults=null,e.destinationResults=o,e.destinationLoading=!1,e.$apply()},e.addMarkerFirst=function(o,n){e.originPlace&&e.destinationPlace?e.markers=null:e.markers=o,e.destinationResults=null,e.originResults=null,n?(e.takeOrigin=!1,e.searchs.origin=o.name,e.originPlace=o):(e.takeDest=!1,e.searchs.destination=o.name,e.destinationPlace=o)},e.onRoute=function(o){e.encodedRoute=o.routes[0].overview_polyline,e.$apply()},e.saveRoute=function(){e.show();var o={encoded:e.encodedRoute,userId:"",running:!1};l.saveRoute(o).then(function(o){console.log(o),s.show("Ruta guardada!"),e.cleanMapVariables(),e.closeModal(),e.hide()},function(e){s.show("Algo salio mal: "+e.message)})},e.savePoint=function(){e.show(),console.log(e.originPlace);var o={lat:e.originPlace.geometry.location.lat(),lng:e.originPlace.geometry.location.lng(),name:e.originPlace.name,icon:e.originPlace.icon,formattedAddress:e.originPlace.formatted_address};l.savePoint(o).then(function(o){console.log(o),s.show("Punto guardado!"),e.cleanMapVariables(),e.closeModal(),e.hide()},function(e){s.show("Algo salio mal: "+e.message)})}}angular.module("yoTeLlevo").component("dashboardComponent",{bindings:{},templateUrl:"templates/dashboard.html",controller:"dashboardCtrl"}).controller("dashboardCtrl",["$scope","$ionicLoading","$state","$ionicTabsDelegate","$rootScope","$ionicModal","$timeout","$apiClient","toast","$interval",e])}(),function(){function e(e,o,n){e.logResults=function(o){e.results=o},e.itemSelected=function(o){e.marker=o,e.results=null}}angular.module("yoTeLlevo").component("findPlaceComponent",{bindings:{},templateUrl:"templates/elements/findPlace.html",controller:"findPlaceCtrl"}).controller("findPlaceCtrl",["$scope","$ionicLoading","$state",e])}(),function(){function e(e,o,n,t){function i(){l.forEach(function(e){e&&(e.setMap(null),e=null)}),l=[]}function a(o,n){n===google.maps.places.PlacesServiceStatus.OK&&(i(),e.$ctrl.onSearch({results:o}))}function r(o,n,t){console.log(o);var i=o.geometry?o.geometry.location:o,a=new google.maps.Marker({map:e.map,position:i,icon:"img/icon-place.png",draggable:t,animation:google.maps.Animation.DROP});l.push(a),console.log(a),google.maps.event.addListener(a,"click",function(){g.setContent(o.name),g.open(e.map,this)}),google.maps.event.addListener(a,"dragend",function(e){if(2==l.length){var o={origin:l[0].position,destination:l[1].position,travelMode:google.maps.TravelMode.DRIVING};u.route(o,function(e,o){if(o==google.maps.DirectionsStatus.OK){d.setDirections(e);var n=e.routes[0].legs[0];console.log(n)}})}}),n&&e.map.setCenter(i),console.log(o)}var l=[];e.encodedRoute="",t(function(){e.map=new google.maps.Map(document.getElementById(e.$ctrl.idMap||"map"),{center:{lat:21.17429,lng:-86.84656},scrollwheel:!0,zoom:12,disableDefaultUI:!0}),c=new google.maps.places.PlacesService(e.map),u=new google.maps.DirectionsService,d=new google.maps.DirectionsRenderer({draggable:!0,map:e.map,suppressMarkers:!0})},2e3),e.marker=null,e.$watch("$ctrl.search",function(e,o){var n={location:{lat:21.17429,lng:-86.84656},radius:"500",query:e};e&&c.textSearch(n,a)},!0),e.$watch("$ctrl.marker",function(e,o){e&&r(e,!0)});var s;e.$watch("$ctrl.origin",function(o){function n(){return t(function(){var n={location:{lat:21.17429,lng:-86.84656},radius:"500",query:o};c.textSearch(n,function(o,n){n===google.maps.places.PlacesServiceStatus.OK&&e.$ctrl.onOriginSearch({results:o})})},1e3)}o&&(s&&t.cancel(s),s=n())}),e.$watch("$ctrl.destination",function(o){function n(){return t(function(){var n={location:{lat:21.17429,lng:-86.84656},radius:"500",query:o};c.textSearch(n,function(o,n){n===google.maps.places.PlacesServiceStatus.OK&&e.$ctrl.onDestinationSearch({results:o})})},1e3)}o&&(s&&t.cancel(s),s=n())}),e.$watch("$ctrl.originPlace",function(o,n){if(o&&e.$ctrl.destinationPlace){var t={origin:o.geometry.location,destination:e.$ctrl.destinationPlace.geometry.location,travelMode:google.maps.TravelMode.DRIVING};u.route(t,function(o,n){if(n==google.maps.DirectionsStatus.OK){console.log(o.routes[0].overview_polyline,o),e.$ctrl.onRoute({route:o}),d.setDirections(o);var t=o.routes[0].legs[0];i(),r(t.start_location,!1,!0),r(t.end_location,!1,!0),console.log(t)}})}},!0),e.$watch("$ctrl.destinationPlace",function(o,n){if(o&&e.$ctrl.originPlace){var t={origin:e.$ctrl.originPlace.geometry.location,destination:o.geometry.location,travelMode:google.maps.TravelMode.DRIVING};u.route(t,function(o,n){if(n==google.maps.DirectionsStatus.OK){e.$ctrl.onRoute({route:o}),d.setDirections(o);var t=o.routes[0].legs[0];i(),r(t.start_location,!1,!0),r(t.end_location,!1,!0),console.log(t)}else e.$ctrl.encodedRoute=null})}},!0);var c,u,d,g=new google.maps.InfoWindow}angular.module("yoTeLlevo").component("googleMapComponent",{bindings:{search:"=",onSearch:"&",marker:"=",idMap:"=",origin:"=",destination:"=",onOriginSearch:"&",onDestinationSearch:"&",onRoute:"&",originPlace:"=",destinationPlace:"="},templateUrl:"templates/elements/googleMaps/googleMap.html",controller:"googleMapCtrl"}).controller("googleMapCtrl",["$scope","$ionicLoading","$state","$timeout",e])}(),function(){function e(e,o,n,t){e.points=e.$ctrl.points,e.$watch("$ctrl.points",function(o){e.points=o})}angular.module("yoTeLlevo").component("listPointsComponent",{bindings:{points:"="},templateUrl:"templates/pointsList.html",controller:"listPointCtrl"}).controller("listPointCtrl",["$scope","$ionicLoading","$state","$rootScope",e])}(),function(){function e(e,o,n){}angular.module("yoTeLlevo").component("listRequestComponent",{bindings:{},templateUrl:"templates/requestList.html",controller:"dashboardCtrl"}).controller("listRequestCtrl",["$scope","$ionicLoading","$state",e])}(),function(){function e(e,o,n){e.routes=e.$ctrl.routes,e.$watch("$ctrl.routes",function(o){e.routes=o,console.log(o)})}angular.module("yoTeLlevo").component("listRoutesComponent",{bindings:{routes:"="},templateUrl:"templates/routeList.html",controller:"listRoutesCtrl"}).controller("listRoutesCtrl",["$scope","$ionicLoading","$state",e])}(),function(){function e(e,o,n,t,i){e.login=function(){t.login(this.username,this.password).then(function(o){console.log(arguments,o),e.hide(),n.go("dashboard")},function(o){e.hide(),i.show(o.data.message)})},e.show=function(){o.show({template:"Loading...",duration:3e3}).then(function(){console.log("The loading indicator is now displayed")})},e.hide=function(){o.hide().then(function(){console.log("The loading indicator is now hidden")})}}angular.module("yoTeLlevo").component("loginComponent",{bindings:{},templateUrl:"templates/login.html",controller:"loginCtrl"}).controller("loginCtrl",["$scope","$ionicLoading","$state","$apiClient","toast",e])}(),function(){function e(e,o,n,t,i){e.user={userType:0},e.register=function(){e.user.username?t.checkUsername(e.user.username).then(function(o){if(o.usernameValid){for(var a=["userType","name","lastname","username","password"],r=1,l=0;l<a.length;l++)console.log(r,e.user[a[l]],e.user[a[l]]!=-1,""!==e.user[a[l]]),r&="undefined"!=typeof e.user[a[l]]&&e.user[a[l]]!=-1&&""!==e.user[a[l]];r?t.register(e.user).then(function(){i.show("Usuario regisrado"),n.go("login")},function(e){i.show("Algo salio mal: "+e.message)}):i.show("Revisa que los campos sean validos")}else i.show("Username existente, escoge otro")},function(e){i.show(e.data.message)}):i.show("Username invalido")}}angular.module("yoTeLlevo").component("registerComponent",{bindings:{},templateUrl:"templates/register.html",controller:"registerCtrl"}).controller("registerCtrl",["$scope","$ionicLoading","$state","$apiClient","toast",e])}(),function(){angular.module("yoTeLlevo").directive("fabButton",["$interval","dateFilter",function(e,o){function n(e,o,n){e.iconClass="ion-android-add"}return{link:n,templateUrl:"templates/directives/fabButton.html"}}])}(),function e(o,n,t){function i(r,l){if(!n[r]){if(!o[r]){var s="function"==typeof require&&require;if(!l&&s)return s(r,!0);if(a)return a(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[r]={exports:{}};o[r][0].call(u.exports,function(e){var n=o[r][1][e];return i(n?n:e)},u,u.exports,e,o,n,t)}return n[r].exports}for(var a="function"==typeof require&&require,r=0;r<t.length;r++)i(t[r]);return i}({1:[function(e,o,n){(function(e){function n(e,o,n,i,a){function r(e,i){var r=t.element('<div class="toast" ng-click="killme($event)">'+e+"</div>"),s=n.$new();return s.killme=function(e){var o=e.srcElement;o.classList.remove("flyIn"),o.classList.add("flyOut"),a(function(){o.remove()},200)},i=i||4e3,o(r)(s),l.append(r),a(function(){r.addClass("flyIn")},0),a(function(){r.removeClass("flyIn"),r.addClass("flyOut"),a(function(){r.remove()},200)},i)}var l=t.element('<div class="toast-container"></div>'),s=e.find("body");return s.append(l),{show:r}}var t="undefined"!=typeof window?window.angular:"undefined"!=typeof e?e.angular:null;o.exports=t.module("angular-toast",[]).factory("toast",n).name,n.$inject=["$document","$compile","$rootScope","$controller","$timeout"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]),function(){function e(e,o){var n="/api",t=function(){return localStorage.getItem("yotellevoApi")},i=function(){return{Authorization:"Basic dXNlcnlvdGVsbGV2bzp5b3RlbGxldm8=","Content-Type":"application/json"}},a=function(o,a){var r="?";for(var l in a)r+=l+"="+a[l]+"&";return r+="token="+t(),e.get(n+o+r,{headers:i()})},r=function(o,t){return e.put(n+o,JSON.stringify(t),{headers:i()})},l=function(o,t){return e.post(n+o,JSON.stringify(t),{headers:i()})},s=function(o,t){return e.delete(n+o,t,{headers:i()})},c=function(e,n,t){var i=o.defer();return t(e,n).then(function(e){i.resolve(e.data)},i.reject),i.promise};this.getLocalUser=function(){var e=localStorage.getItem("ytllocaluser");return e?JSON.parse(e):null},this.login=function(e,n){var t=o.defer();return c("/login",{username:e,password:n},a).then(function(e){localStorage.setItem("ytllocaluser",JSON.stringify(e.user)),t.resolve(e)},t.reject),t.promise},this.register=function(e){return c("/users",e,r)},this.checkUsername=function(e){return c("/users/checkUsername/"+e,{},a)},this.savePoint=function(e){var o=this.getLocalUser();return e.userId=o._id.toString(),c("/addPoint",{point:e},r)},this.deletePoint=function(e){return c("/deletePoint",{idPoint:e},s)},this.getPoints=function(e){var o=this.getLocalUser();return console.log(o._id.toString()),c("/getPoints",{idUser:o._id.toString(),page:e},a)},this.checkNotifications=function(){return c("/users/notifications",{},a)},this.sendNotification=function(e){var o={};return o.tokens=[localStorage.getItem("pushToken")],o.profile="",o.notification={message:e},c("https://api.ionic.io/push/notifications",o,l)},this.saveRoute=function(e){var o=this.getLocalUser();return e.userId=o._id.toString(),c("/routes",e,r)},this.getRoutes=function(){var e=this.getLocalUser();return console.log(e._id.toString()),c("/routes",{userId:e._id.toString()},a)}}angular.module("yoTeLlevo").service("$apiClient",["$http","$q",e])}(),function(){function e(e,o,n){e.point=e.$ctrl.point}angular.module("yoTeLlevo").component("cardComponent",{bindings:{point:"="},templateUrl:"templates/elements/card/card-point.html",controller:"cardCtrl"}).controller("cardCtrl",["$scope","$ionicLoading","$state",e])}(),function(){function e(e,o,n){e.route=e.$ctrl.route}angular.module("yoTeLlevo").component("cardRouteComponent",{bindings:{route:"="},templateUrl:"templates/elements/card/card.html",controller:"cardRouteCtrl"}).controller("cardRouteCtrl",["$scope","$ionicLoading","$state",e])}();